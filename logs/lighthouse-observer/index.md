---
title: Web ã‚µã‚¤ãƒˆã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å®šç‚¹è¦³æ¸¬ã™ã‚‹ä»•çµ„ã¿ã‚’ä½œã£ãŸè©±
description: Google Cloud Functions ã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§ Lighthouse ã‚’å®šç‚¹è¦³æ¸¬ã™ã‚‹ ligthouse-observer ã‚’ä½œã‚Šã¾ã—ãŸã€‚
tags: 
  - Google Cloud Functions
  - Spreadsheet
  - Lighthouse
  - ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¿ãƒ«
  - ligthouse-observer
  - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
date: 2020-12-01 00:00:00 UTC
slug: lighthouse-observer
---

ã“ã®è¨˜äº‹ã¯ [YAMAP ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ Advent Calender 2020](https://qiita.com/advent-calendar/2020/yamap-engginers) 1æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬ã«è‡³ã£ãŸç†ç”±

YAMAP ã§ã¯åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹ç”»é¢ãŒå¤šã„ã§ã™ã€‚  
åœ°å›³ã«ã¯ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã®ãƒ”ãƒ³ã‚¢ã‚¤ã‚³ãƒ³ã ã£ãŸã‚Šã€ç™»å±±é“ã ã£ãŸã‚Šã€ãŸãã•ã‚“ã®è¦ç´ ã‚’è¡¨ç¤ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ãƒšãƒ¼ã‚¸ãŒé‡ã„ã“ã¨ãŒä½“æ„Ÿçš„ã«ã‚ã‹ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã—ãŸã€‚  
ã—ã‹ã—ã€å®Ÿéš›ã«é‡ã„ã®ã‹ã©ã†ã‹ã‚ˆãã‚ã‹ã‚‰ãªã„ã—ã€æ”¹å–„ã™ã‚‹ãŸã‚ã«ã‚‚æŒ‡æ¨™ãŒå¿…è¦ã§ã™ã€‚  
ãã“ã§ãªã«ã‹æŒ‡æ¨™ã‚’æ±ºã‚ã¦ã€è¨ˆæ¸¬ã‚’ã—ã‚ˆã†ã¨æ€ã„ã¾ã—ãŸã€‚

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æŒ‡æ¨™

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æŒ‡æ¨™ã«ã¤ã„ã¦èª¿ã¹ã¦ã„ã‚‹ã¨ã€Web ã‚µã‚¤ãƒˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®è¦³æ¸¬ã«ã¯2ã¤ã®è¦–ç‚¹ãŒã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚

### åˆæˆãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

åˆæˆãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¯ã€åŒã˜ç’°å¢ƒã§å®šæœŸçš„ã«ç¹°ã‚Šè¿”ã—è¨ˆæ¸¬ã—ã¾ã™ã€‚  
ã‚ã‚‹ç‰¹å®šã®ç’°å¢ƒã‚’ã‚·ãƒ¥ãƒŸãƒ¬ãƒ¼ãƒˆã—ã€ãã®ç’°å¢ƒã§è¨ˆæ¸¬ã‚’ç¶šã‘ã‚‹ã®ã§ã€è¨ˆæ¸¬çµæœã®ã‚†ã‚‰ããŒå°‘ãªã„ã§ã™ã€‚  
ã“ã®å¾Œæ›¸ããƒªã‚¢ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¨é•ã£ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç’°å¢ƒã®é•ã„ã‚’è€ƒæ…®ã—ã¾ã›ã‚“ã€‚  

### ãƒªã‚¢ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

ãƒªã‚¢ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¯ã€å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’è¨ˆæ¸¬ã—ã¾ã™ã€‚    
è¨ˆæ¸¬ç’°å¢ƒã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹ãŸã‚ã€è¨ˆæ¸¬çµæœã®ã‚†ã‚‰ãã¯å¤§ãã„ã§ã™ã€‚  

### æŒ‡æ¨™ã¯åˆæˆãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

ç¶™ç¶šçš„ã«æ”¹å–„ã—ã¦ã„ãã“ã¨ã‚’è€ƒãˆã¦ã„ãŸã®ã§ã€ç’°å¢ƒã«ã‚ˆã‚‹ã‚†ã‚‰ãã®å°‘ãªã„åˆæˆãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã†ã“ã¨ã«ã—ã¾ã—ãŸã€‚  
ãƒšãƒ¼ã‚¸ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã‚’æ¸¬å®šã—ã¦ãã‚Œã‚‹ Lighthouse ã‚’ä½¿ã£ã¦å®šç‚¹è¦³æ¸¬ã—ã€ãã®çµæœã‚’æŒ‡æ¨™ã«ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚  

> æœ¬å½“ã¯ã©ã£ã¡ã‚‚ã‚„ã‚‹ã®ãŒã„ã„ã®ã ã¨æ€ã„ã¾ã™ã€‚  
> ãƒªã‚¢ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¯å®Ÿéš›ã®æ•°å€¤ãŒè¦‹ã‚Œã‚‹ã®ã§ã€åˆæˆãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¨çµæœã‚’æ¯”è¼ƒã™ã‚‹ã“ã¨ã§ã€åˆæˆãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã®ç’°å¢ƒè¨­å®šã‚’è¦‹ç›´ã™ã“ã¨ãŒã§ããŸã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã‚’çŸ¥ã‚‹ã“ã¨ãŒã§ããã†ã§ã™ã€‚  

Â ## lighthouse-observer ã®æ§‹æˆ

### æ¦‚è¦

![ligthouse-observer-architecture](https://dl.dropboxusercontent.com/s/0bdsgy38ah6wzih/ligthouse-observer-architecture.png)

lighthouse-observer ã¯é–¢æ•°ã§ã™ã€‚
ã“ã®é–¢æ•°ã‚’ Cloud Functions ã¨ã—ã¦å®šæœŸå®Ÿè¡Œã—ã€ãã®çµæœã‚’ Spreadsheet ã«è¨˜éŒ²ã—ã¾ã™ã€‚
ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¿ãƒ«ã‹ã‚‰ Spreadsheet ã«æ¥ç¶šã—ã€è¨ˆæ¸¬çµæœã‚’ã‚°ãƒ©ãƒ•åŒ–ã—ã€çµŒéã‚’è¦‹ã‚„ã™ãã—ã¦ã„ã¾ã™ã€‚

[![yamap-inc/lighthouse-observer - GitHub](https://gh-card.dev/repos/yamap-inc/lighthouse-observer.svg)](https://github.com/yamap-inc/lighthouse-observer)

### è©³ç´°

#### Cloud Scheduler ã¨ Cloud Pub/Sub ã¨ Cloud Functions

Cloud Scheduler ã¨ Cloud Pub/Sub ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ Cloud Functions ã‚’å®šæœŸå®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  

![Cloud Schedulerã¨Cloud Pub/Subã¨Cloud Functionsã®èª¬æ˜](https://dl.dropboxusercontent.com/s/8hpgnv8sim8vjuu/ligthouse-observer-gcp.png)

Cloud Scheduler ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¨ã—ã¦ã€æ¬¡ã®ã‚ˆã†ãª json ã‚’è¨­å®šã—ã¾ã™ã€‚  
ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼èµ·å‹•æ™‚ã€ã“ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¯ Cloud Pub/Sub ã‚’é€šã—ã¦ã€Cloud Functions ã¸é€šçŸ¥ã•ã‚Œã¾ã™ã€‚  

```json
{
  "spreadsheetId": "${your_spreadsheet_id}",
  "timezone": "Asia/Tokyo",
  "targets": [
    {
      "url": "https://yamap.com",
      "sheetName": "top"
    },
    {
      "url": "https://yamap.com/maps",
      "sheetName": "maps"
    }
  ]
}
```

ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸã‚Šã€è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€æŸ”è»Ÿãªå¯¾å¿œãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚  
Cloud Functions ã«ã¯å®Ÿè¡Œæ™‚é–“ã®ä¸Šé™ï¼ˆ540sï¼‰ã‚„ãƒ¡ãƒ¢ãƒªã®ä¸Šé™ï¼ˆ2GBï¼‰ãŒã‚ã‚‹ã®ã§ã€å¡©æ¢…ã‚’è€ƒãˆã¦è¨ˆæ¸¬å¯¾è±¡ã‚’åˆ†å‰²ã—ã¦ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç™»éŒ²ã—ãŸã‚Šã—ã¦ã„ã¾ã™ã€‚  

#### è¨ˆæ¸¬çµæœã‚’ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¿ãƒ«ã§å¯è¦–åŒ–

[ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¿ãƒ«](https://marketingplatform.google.com/intl/ja/about/data-studio/)ã¯ Google ãŒæä¾›ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®ã²ã¨ã¤ã§ã€ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ã‚„ã‚°ãƒ©ãƒ•ãªã©ã§å¯è¦–åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã™ãã‚Œã‚‚ã®ã§ã™ã€‚  
ãƒ‡ãƒ¼ã‚¿ã®ãƒªã‚½ãƒ¼ã‚¹ã¨ã—ã¦ã€Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‚„ MySQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãªã©ã‚’é¸ã¶ã“ã¨ãŒã§ãã¾ã™ã€‚æ—¥ä»˜ã«ã‚ˆã‚‹çµã‚Šè¾¼ã¿ã‚‚ GUI ã‹ã‚‰ãƒ‘ãƒ¼ãƒ„ã‚’é…ç½®ã™ã‚‹ã ã‘ã§ç°¡å˜ã«ã§ãã‚‹ã®ã§ã€ã™ã”ãåŠ©ã‹ã‚Šã¾ã—ãŸã€‚  

å®Ÿéš›ã®è¡¨ç¤ºã¯ã“ã‚“ãªé¢¨ã«ãªã£ã¦ã„ã¾ã™ã€‚  
11/26 ã«å¤§ãããƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ã‚¹ã‚³ã‚¢ãŒè½ã¡ã¦ã„ã¾ã™ã­ï¼ˆmax=1ï¼‰ğŸ˜£  

![ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ã‚¿ãƒ«ã§ã®è¡¨ç¤º](https://dl.dropboxusercontent.com/s/bh8kipxscd37uwy/lighthouse-observer-web_%28daily%29.png)

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å¯è¦–åŒ–ã—ã¦ã¿ã¦

å•é¡ŒãŒã‚ã‚Šãã†ã«è¦‹ãˆã‚‹ã‚‚ã®ã¯å®šé‡åŒ–ã™ã‚‹ã¨ã‚ˆã„ã¨ã€æ”¹ã‚ã¦æ€ã„ã¾ã—ãŸã€‚  
å®Ÿéš›ã€è¨ˆæ¸¬å‰ã®ä½“æ„Ÿã©ãŠã‚Šã€åœ°å›³ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ãŒé…ã„ã“ã¨ãŒã‚ã‹ã£ãŸã‚Šã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®å®Ÿè£…ã§æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸã‚Šã—ã¾ã—ãŸã€‚  
YAMAP ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒãƒ¼ãƒ ã¯é€±ã«ä¸€å›ã€ãƒãƒ¼ãƒ ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã£ã¦ã„ã¦ã€ãã®ä¸­ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ã‚µãƒãƒªãƒ¼ã‚’å…±æœ‰ã—ã¦ã€ã‚ã‚ã ã“ã†ã è¨€ã†æ™‚é–“ã‚’è¨­ã‘ã¦ã‚‚ã‚‰ã£ã¦ã„ã¾ã™ã€‚  
ã¾ã ã“ã®æŒ‡æ¨™ã‚’æ´»ç”¨ã—ãã‚Œã¦ã„ã‚‹ã¨ã¯è¨€ãˆã¾ã›ã‚“ãŒã€ä»²é–“ã‚’å¢—ã‚„ã—ã¦ã‚„ã£ã¦ã„ã“ã†ã¨æ€ã£ã¦ã„ã¾ã™ã€‚  

## ï¼ˆé›‘è«‡ï¼‰ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«é–¢ã™ã‚‹åè¨€

### ã€Œæ¨æ¸¬ã™ã‚‹ãªè¨ˆæ¸¬ã›ã‚ˆã€

æœ‰åãªè¨€è‘‰ã§ã™ã‚ˆã­ã€‚  
ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã¯ã©ã“ã«ã‚ã‚‹ã‹ã‚ã‹ã‚‰ãªã„ã®ã§ã€ã‚ã‹ã‚‰ãªã„ã¾ã¾ã‚„ã¿ãã‚‚ã«æ”¹å–„ã™ã‚‹ã®ã¯ã‚ˆããªã„ã§ã™ã€‚  
æ”¹ã‚ã¦èª¿ã¹ã¦ã¿ã‚‹ã¨ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢å·¥å­¦è€…ã§ã‚ã‚‹[ãƒ­ãƒãƒ¼ãƒˆãƒ»Cãƒ»ãƒ‘ã‚¤ã‚¯](https://ja.wikipedia.org/wiki/ãƒ­ãƒ–ãƒ»ãƒ‘ã‚¤ã‚¯)ã•ã‚“ã®[Cãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«é–¢ã™ã‚‹è¦šæ›¸](https://ja.wikipedia.org/wiki/UNIXå“²å­¦)ã®ä¸­ã§è¿°ã¹ã‚‰ã‚Œã¦ã„ã‚‹è¨€è‘‰ã ã¨ã‚ã‹ã‚Šã¾ã—ãŸã€‚  

### ã€Œxxxç§’é…ããªã‚‹ã¨xxxã€ã‚·ãƒªãƒ¼ã‚º

> ã‚µã‚¤ãƒˆè¡¨ç¤ºãŒ0.1ç§’é…ããªã‚‹ã¨ã€å£²ã‚Šä¸Šã’ãŒ1%æ¸›å°‘ã—ã€1ç§’é«˜é€ŸåŒ–ã™ã‚‹ã¨10%ã®å£²ä¸ŠãŒå‘ä¸Šã™ã‚‹ã€‚
> ãƒ¼ [Web experiments generate insights and promote innovation.](http://robotics.stanford.edu/~ronnyk/2007IEEEComputerOnlineExperiments.pdf)

> è¡¨ç¤ºé€Ÿåº¦ãŒ1ç§’ã‹ã‚‰3ç§’ã«ãªã‚‹ã¨ç›´å¸°ç‡ã¯32%ä¸Šæ˜‡
> ãƒ¼ [Find out how you stack up to new industry benchmarks for mobile page speed](https://www.thinkwithgoogle.com/marketing-resources/data-measurement/mobile-page-speed-new-industry-benchmarks/)

ã‚µã‚¤ãƒˆã‚¹ãƒ”ãƒ¼ãƒ‰ãŒãƒ“ã‚¸ãƒã‚¹ã«ä¸ãˆã‚‹å½±éŸ¿ã‚‚å¤§ãã„ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚  
å‰ã„äººã‚’èª¬å¾—ã™ã‚‹ã¨ãã«ä½¿ãˆãã†ğŸ˜Œ  

## å‚è€ƒ

- [è¶…é€Ÿï¼ Webãƒšãƒ¼ã‚¸é€Ÿåº¦æ”¹å–„ã‚¬ã‚¤ãƒ‰](https://gihyo.jp/book/2017/978-4-7741-9400-4)

- [Synthetic monitoring (åˆæˆãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°)](https://developer.mozilla.org/ja/docs/Glossary/Synthetic_monitoring)

- [Performance Monitoring: RUM vs synthetic monitoring](https://developer.mozilla.org/en-US/docs/Web/Performance/Rum-vs-Synthetic)

  